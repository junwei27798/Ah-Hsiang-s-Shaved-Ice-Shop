<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>剉冰訂單（加減號調整）</title>
  <style>
    .topping {
      margin-bottom: 10px;
    }
    .topping label {
      display: inline-block;
      width: 80px;
    }
    .qty-controls {
      display: inline-flex;
      align-items: center;
    }
    .qty-controls button {
      width: 28px;
      height: 28px;
      font-size: 20px;
      line-height: 20px;
      cursor: pointer;
      user-select: none;
    }
    .qty-controls input[type="number"] {
      width: 40px;
      text-align: center;
      margin: 0 5px;
      font-size: 16px;
    }
  </style>
</head>
<body>
  <h1>剉冰訂單表單</h1>

  <form id="orderForm" method="POST" target="hidden_iframe" action="https://script.google.com/macros/s/AKfycbzEJ_Z-QY9Of3tpzCLck-gqC5h5WZx836RD0V6AiDMjbv7q_vMiwMOk6r_d7PRLvPRZ/exec">
    <label>
      訂購人名字：
      <input type="text" name="displayName" value="測試用戶" required />
    </label>
    <br /><br />

    <fieldset>
      <legend>基本配料 (必選)</legend>

      <div class="topping">
        <label for="redBean">紅豆</label>
        <div class="qty-controls">
          <button type="button" data-target="redBean">−</button>
          <input type="number" id="redBean" min="0" value="0" readonly name="redBean" />
          <button type="button" data-target="redBean">＋</button>
        </div>
      </div>

      <div class="topping">
        <label for="greenBean">綠豆</label>
        <div class="qty-controls">
          <button type="button" data-target="greenBean">−</button>
          <input type="number" id="greenBean" min="0" value="0" readonly name="greenBean" />
          <button type="button" data-target="greenBean">＋</button>
        </div>
      </div>

      <div class="topping">
        <label for="grassJelly">仙草</label>
        <div class="qty-controls">
          <button type="button" data-target="grassJelly">−</button>
          <input type="number" id="grassJelly" min="0" value="0" readonly name="grassJelly" />
          <button type="button" data-target="grassJelly">＋</button>
        </div>
      </div>

      <div class="topping">
        <label for="taroBall">芋圓</label>
        <div class="qty-controls">
          <button type="button" data-target="taroBall">−</button>
          <input type="number" id="taroBall" min="0" value="0" readonly name="taroBall" />
          <button type="button" data-target="taroBall">＋</button>
        </div>
      </div>
    </fieldset>

    <br />

    <fieldset>
      <legend>額外配料 (可選)</legend>

      <div class="topping">
        <label for="condensedMilk">煉乳</label>
        <div class="qty-controls">
          <button type="button" data-target="condensedMilk">−</button>
          <input type="number" id="condensedMilk" min="0" value="0" readonly name="condensedMilk" />
          <button type="button" data-target="condensedMilk">＋</button>
        </div>
      </div>

      <div class="topping">
        <label for="chocolateSauce">巧克力醬</label>
        <div class="qty-controls">
          <button type="button" data-target="chocolateSauce">−</button>
          <input type="number" id="chocolateSauce" min="0" value="0" readonly name="chocolateSauce" />
          <button type="button" data-target="chocolateSauce">＋</button>
        </div>
      </div>
    </fieldset>

    <!-- 隱藏欄位放 JSON -->
    <input type="hidden" name="items" id="itemsInput" />

    <br />
    <button type="submit">送出訂單</button>
  </form>

  <iframe name="hidden_iframe" style="display:none;"></iframe>

  <script>
    // 加減號按鈕事件
    document.querySelectorAll(".qty-controls button").forEach(button => {
      button.addEventListener("click", () => {
        const targetId = button.getAttribute("data-target");
        const input = document.getElementById(targetId);
        let currentValue = parseInt(input.value) || 0;
        if (button.textContent === "＋") {
          input.value = currentValue + 1;
        } else if (button.textContent === "−") {
          if (currentValue > 0) {
            input.value = currentValue - 1;
          }
        }
      });
    });

    // 表單送出前包裝 JSON 放到隱藏欄位
    document.getElementById("orderForm").addEventListener("submit", function (e) {
      const baseToppings = {
        "紅豆": Number(document.getElementById("redBean").value),
        "綠豆": Number(document.getElementById("greenBean").value),
        "仙草": Number(document.getElementById("grassJelly").value),
        "芋圓": Number(document.getElementById("taroBall").value),
      };

      for (const key in baseToppings) {
        if (baseToppings[key] === 0) delete baseToppings[key];
      }

      const extraToppings = {
        "煉乳": Number(document.getElementById("condensedMilk").value),
        "巧克力醬": Number(document.getElementById("chocolateSauce").value),
      };

      for (const key in extraToppings) {
        if (extraToppings[key] === 0) delete extraToppings[key];
      }

      const items = [
        {
          baseToppings: baseToppings,
          extraToppings: extraToppings,
        },
      ];

      document.getElementById("itemsInput").value = JSON.stringify(items);
    });
  </script>
</body>
</html>
